<!--
//------------------------------------------------------------------------------
// <auto-generated>
//     This code was generated from a template.
//
//     Manual changes to this file may cause unexpected behavior in your application.
//     Manual changes to this file will be overwritten if the code is regenerated.
// </auto-generated>
//------------------------------------------------------------------------------
-->

@inject IStringLocalizer<App> Localize

<div class="grid-area">
	<MatSelectItem Label="Select filter column" @bind-Value="SelectFilterByColumn" Items="@FilterColumns" Style="display: inline;">
        <ItemTemplate Context="filter">
            <span>@filter?.Text</span>
        </ItemTemplate>
    </MatSelectItem>
	<MatTable Items="@Courses" class="mat-elevation-z5" Striped="true" ShowPaging="true" FilterByColumnName="@(SelectFilterByColumn?.Key)"
				UseSortHeaderRow="true" AllowSelection="true" SelectionChanged="SelectionChangedEvent" Style="white-space:nowrap">
		<MatTableHeader>
			<MatSortHeaderRow SortChanged="@SortData">
			@if (IsAdmin)
			{
				<MatSortHeader SortId="id">@Localize["Id"]</MatSortHeader>
			}
			<MatSortHeader SortId="code">@Localize["Code"]</MatSortHeader>
			<MatSortHeader SortId="title">@Localize["Title"]</MatSortHeader>
			<MatSortHeader SortId="unit">@Localize["Unit"]</MatSortHeader>
			<MatSortHeader>@EditColumnName</MatSortHeader>
		</MatSortHeaderRow>
	</MatTableHeader>
	<MatTableRow Context="course">
		@if (IsAdmin)
		{
			<td>@course.Id</td>
		}
			<td>@course.Code</td>
			<td>@course.Title</td>
			<td>@course.Unit</td>
			<td>
				@if(CanUpdate)
				{
				<!-- Edit the current course -->
				<MatButton Raised="true" @onclick="(() => OnEdit.InvokeAsync(course))" Icon="@MatIconNames.Edit" title="@(Localize["Edit Course"])">@(Localize["Edit Course"])</MatButton>
				}
				@if (EditColumnRowTemplate != null)
                {
					@EditColumnRowTemplate(course)
                }
			</td>
		</MatTableRow>
	</MatTable>
</div>

	
@code {
    
	[Parameter] public String SelectFilterColumnKey { get; set; }
	public MatFilter SelectFilterByColumn { get; set; }
    [Parameter] public MatFilter[] FilterColumns { get; set; } = new[]
            {            
            new MatFilter{ Key= "Code", Text="Code" },
            new MatFilter{ Key= "Title", Text="Title" },
            new MatFilter{ Key= "Unit", Text="Unit" },
            };
	
	[Parameter] public string EditColumnName { get; set; }
	[Parameter] public RenderFragment<CourseDto> EditColumnRowTemplate { get; set; }

    [Parameter] public bool IsAdmin { get; set; }
    [Parameter] public bool CanUpdate { get; set; }

    [Parameter] public CourseDto[] Courses { get; set; }

    //<!-- StudentCourses | StudentCourse | Collectiion -->

	[Parameter] public EventCallback<CourseDto> OnSelectionChanged { get; set; }
    [Parameter] public EventCallback<CourseDto> OnEdit { get; set; }

	protected override void OnInitialized()
    {
        // SelectFilterByColumn = FilterColumns.FirstOrDefault();
    }
	
    public void SelectionChangedEvent(object row)
    {
        if (row != null)
        {
            var selected = (CourseDto)row;
            OnSelectionChanged.InvokeAsync(selected);
        }
    }

    void SortData(MatSortChangedEvent sort)
    {
        // courses = desserts.ToArray();
        if (!(sort == null || sort.Direction == MatSortDirection.None || string.IsNullOrEmpty(sort.SortId)))
        {
            Comparison<CourseDto> comparison = null;
            switch (sort.SortId)
            {
                case "id":
                    comparison = (s1, s2) => string.Compare(s1.Id.ToString(), s2.Id.ToString(), StringComparison.InvariantCultureIgnoreCase);
                    break;
				case "code":
                    comparison = (s1, s2) => string.Compare(s1.Code.ToString(), s2.Code.ToString(), StringComparison.InvariantCultureIgnoreCase);
                    break;
				case "title":
                    comparison = (s1, s2) => string.Compare(s1.Title.ToString(), s2.Title.ToString(), StringComparison.InvariantCultureIgnoreCase);
                    break;
				case "unit":
                    comparison = (s1, s2) => string.Compare(s1.Unit.ToString(), s2.Unit.ToString(), StringComparison.InvariantCultureIgnoreCase);
                    break;
            }
            if (comparison != null)
            {
                if (sort.Direction == MatSortDirection.Desc)
                {
                    Array.Sort(Courses, (s1, s2) => -1 * comparison(s1, s2));
                }
                else
                {
                    Array.Sort(Courses, comparison);
                }
            }
        }
    }



}

